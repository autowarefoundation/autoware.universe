# 振る舞い経路サンプルベースプランナー

警告: このモジュールは実験的であり、実車両では適切にテストされていません。シミュレーションでのみ使用してください。

## 目的

このパッケージでは、サンプリングベースプランニングを使用して、振る舞い経路プランナーのための走行可能なトラジェクトリを生成するノードを実装しています。[sampling_based_plannerモジュール](https://github.com/autowarefoundation/autoware.universe/tree/main/planning/sampling_based_planner)を大幅にベースにしています。

## 特徴

このパッケージでは、次のことができます。

- 静的障害物を避けるスムースなトラジェクトリを作成する。
- 生成されたトラジェクトリ（存在する場合）がカスタマイズ可能なハード制約に確実に準拠するようにする。
- 自車がゴールレーンに合流した後、成功状態に移行する。
- 以前生成した出力を再利用して、新しい代替経路を再サンプリングする

ここで速度は入力経路からそのまま引き継がれることに注意してください。

## アルゴリズム

サンプリングベースプランニングは、3つの連続した手順に分解されます。

1. サンプリング: 候補のトラジェクトリが生成されます。
2. プルーニング: 無効な候補は破棄されます。
3. 選択: 残りの有効な候補の中で最適なものが選択されます。

### サンプリング

候補のトラジェクトリは、現在の車両状態とターゲット状態に基づいて生成されます。
現在実装されているサンプリングアルゴリズムは1つです。フレネフレームにおける多項式

### プルーニング

各候補トラジェクトリの有効性は、一連のハード制約を使用してチェックされます。

- 衝突: 静的障害物との衝突がないことを保証する。
- 曲率: 滑らかな曲率を保証する。
- 走行可能領域: トラジェクトリが走行可能領域内にとどまることを保証する。

### 選択

有効な候補のトラジェクトリの中から、一連のソフト制約（つまり目的関数）を使用して最適なものが決定されます。

- 曲率: よりスムーズなトラジェクトリを優先する。
- 長さ: 残り経路長が長いトラジェクトリを優先する。
- 横方向逸脱: ゴールに近いトラジェクトリを優先する。

各ソフト制約には重み付けが関連付けられており、プリファレンスの調整が可能です。

## 制限事項

フレネフレーム内の多項式で生成された候補の品質は、参照経路に大きく依存します。
参照経路がスムースでない場合、生成された候補は走行不能になる可能性が高くなります。

現在、有効なトラジェクトリが見つからないと、突然停止するトラジェクトリが発生します。

このモジュールは、ゴールレーンのレットに素早く収束する経路を生成することに問題があります。基本的には、すべての障害物を克服した後、このモジュールは車両をゴールレーンに素早く収束させる経路（つまり、平均横方向逸脱と最終横方向逸脱が低い経路）を優先するはずです。ただし、現時点では正しく機能していません。

## 今後の取り組み

このモジュールには次のような潜在的な改善事項が含まれます。

*動的重み調整アルゴリズムの実装: 全ての障害物が回避された後、シチュエーションに応じて重みを動的に変更する (つまり、曲率が低く、平均横方向逸脱量が低いパスを優先する)。

*コンピューティング時間を改善し、より動的なソフト制約の重み調整を行うことができる、多目的最適化の実装 [関連出版物](https://ieeexplore.ieee.org/abstract/document/10180226)。

*別のサンプル取得手法としてベジエ曲線を実装する [sampling_based_plannerモジュール](https://github.com/autowarefoundation/autoware.universe/tree/main/planning/sampling_based_planner)を参照。

*サンプリングベースの行動経路モジュールで他のいくつかの行動経路モジュールを置き換えることができる可能性を検討する。

*このモジュールが成熟し、いくつかの制限が解決されたら、このモジュールのリアルライフテストを実施する。

## その他の可能性

現在、このモジュールは静的障害物回避用パスの作成を目的としています。ただし、サンプリングプランナーの性質により、このモジュールを車線変更、動的回避、目標への一般的な到達などの他のタスクに拡張または転用できます。適切な候補の剪定とソフト制約の適切な重み調整を前提に、サンプリングプランニングの手法を他の行動経路モジュールの代替として使用することが可能です。

