<launch>
    <!-- NOTE: -->
    <arg name="standalone" description="[true,false] Set to true if not connected to Autoware's P/C."/>
    <arg name="use_sim_time" default="true"/>

    <!-- source camera image topics -->
    <arg name="src_image_0" default="/sensing/camera/camera0/image_rect_color/compressed"/>
    <arg name="src_info_0" default="/sensing/camera/camera0/camera_info"/>
    <arg name="src_image_1" default="/sensing/camera/camera1/image_rect_color/compressed"/>
    <arg name="src_info_1" default="/sensing/camera/camera1/camera_info"/>
    <arg name="src_image_2" default="/sensing/camera/camera2/image_rect_color/compressed"/>
    <arg name="src_info_2" default="/sensing/camera/camera2/camera_info"/>
    <arg name="src_image_3" default="/sensing/camera/camera3/image_rect_color/compressed"/>
    <arg name="src_info_3" default="/sensing/camera/camera3/camera_info"/>
    <arg name="src_image_4" default="/sensing/camera/camera4/image_rect_color/compressed"/>
    <arg name="src_info_4" default="/sensing/camera/camera4/camera_info"/>
    <arg name="src_image_5" default="/sensing/camera/camera5/image_rect_color/compressed"/>
    <arg name="src_info_5" default="/sensing/camera/camera5/camera_info"/>

    <!-- conditional branch for autoware integration -->
    <let name="connect_base_link_to_particle_pose" value="true" if="$(var standalone)"/>
    <let name="connect_base_link_to_particle_pose" value="false" unless="$(var standalone)"/>
    <let name="input_pose" value="/localization/yabloc/pf/pose" if="$(var standalone)"/>
    <let name="input_pose" value="/localization/pose_twist_fusion_filter/pose" unless="$(var standalone)"/>

    <!-- default parameter path -->
    <!-- initializer -->
    <arg name="camera_pose_initializer_param_path" default="$(find-pkg-share camera_pose_initializer)/config/camera_pose_initializer.param.yaml"/>
    <!-- particle filter-->
    <arg name="camera_particle_corrector_param_path" default="$(find-pkg-share camera_particle_corrector)/config/camera_particle_corrector.param.yaml"/>
    <arg name="gnss_particle_corrector_param_path" default="$(find-pkg-share gnss_particle_corrector)/config/gnss_particle_corrector.param.yaml"/>
    <arg name="predictor_param_path" default="$(find-pkg-share modularized_particle_filter)/config/predictor.param.yaml"/>
    <!-- image processing -->
    <arg name="graph_segment_param_path" default="$(find-pkg-share graph_segment)/config/graph_segment.param.yaml"/>
    <arg name="segment_filter_param_path" default="$(find-pkg-share segment_filter)/config/segment_filter.param.yaml"/>
    <arg name="undistort_param_path" default="$(find-pkg-share undistort)/config/undistort.param.yaml"/>
    <!-- map -->
    <arg name="ground_server_param_path" default="$(find-pkg-share ground_server)/config/ground_server.param.yaml"/>
    <arg name="ll2_decomposer_param_path" default="$(find-pkg-share ll2_decomposer)/config/ll2_decomposer.param.yaml"/>
    <!-- twist estimator -->
    <arg name="twist_estimator_param_path" default="$(find-pkg-share twist_estimator)/config/twist_estimator.param.yaml"/>

    <group>
        <push-ros-namespace namespace="localization/yabloc"/>

        <!-- initializer -->
        <group>
            <push-ros-namespace namespace="initializer"/>
            <include file="$(find-pkg-share yabloc_launch)/launch/impl/initializer.launch.xml">
                <arg name="skip_autoware_pose_initializer" value="$(var standalone)"/>
            </include>
        </group>

        <!-- particle filter -->
        <group>
            <push-ros-namespace namespace="pf"/>
            <include file="$(find-pkg-share yabloc_launch)/launch/impl/pf.launch.xml"/>
        </group>

        <!-- camera processing -->
        <group if="$(var use_camera_0)">
            <push-ros-namespace namespace="camera0/imgproc"/>
            <include file="$(find-pkg-share yabloc_launch)/launch/impl/camera.launch.xml">
                <arg name="src_image" value="$(var src_image_0)"/>
                <arg name="src_info" value="$(var src_info_0)"/>
                <arg name="input_pose" value="$(var input_pose)"/>
            </include>
        </group>
        <group if="$(var use_camera_1)">
            <push-ros-namespace namespace="camera1/imgproc"/>
            <include file="$(find-pkg-share yabloc_launch)/launch/impl/camera.launch.xml">
                <arg name="src_image" value="$(var src_image_1)"/>
                <arg name="src_info" value="$(var src_info_1)"/>
                <arg name="input_pose" value="$(var input_pose)"/>
            </include>
        </group>
        <group if="$(var use_camera_2)">
            <push-ros-namespace namespace="camera2/imgproc"/>
            <include file="$(find-pkg-share yabloc_launch)/launch/impl/camera.launch.xml">
                <arg name="src_image" value="$(var src_image_2)"/>
                <arg name="src_info" value="$(var src_info_2)"/>
                <arg name="input_pose" value="$(var input_pose)"/>
            </include>
        </group>
        <group if="$(var use_camera_3)">
            <push-ros-namespace namespace="camera3/imgproc"/>
            <include file="$(find-pkg-share yabloc_launch)/launch/impl/camera.launch.xml">
                <arg name="src_image" value="$(var src_image_3)"/>
                <arg name="src_info" value="$(var src_info_3)"/>
                <arg name="input_pose" value="$(var input_pose)"/>
            </include>
        </group>
        <group if="$(var use_camera_4)">
            <push-ros-namespace namespace="camera4/imgproc"/>
            <include file="$(find-pkg-share yabloc_launch)/launch/impl/camera.launch.xml">
                <arg name="src_image" value="$(var src_image_4)"/>
                <arg name="src_info" value="$(var src_info_4)"/>
                <arg name="input_pose" value="$(var input_pose)"/>
            </include>
        </group>
        <group if="$(var use_camera_5)">
            <push-ros-namespace namespace="camera5/imgproc"/>
            <include file="$(find-pkg-share yabloc_launch)/launch/impl/camera.launch.xml">
                <arg name="src_image" value="$(var src_image_5)"/>
                <arg name="src_info" value="$(var src_info_5)"/>
                <arg name="input_pose" value="$(var input_pose)"/>
            </include>
        </group>

        <!-- map -->
        <group>
            <push-ros-namespace namespace="map"/>
            <include file="$(find-pkg-share yabloc_launch)/launch/impl/map.launch.xml">
                <arg name="input_particle_pose" value="$(var input_pose)"/>
            </include>
        </group>

        <!-- static tf -->
        <group if="$(var connect_base_link_to_particle_pose)"> 
            <node name="base_link_tf" pkg="tf2_ros" exec="static_transform_publisher" args="--frame-id /particle_filter --child-frame-id /base_link"/>
        </group>

        <!-- twist -->
        <group>
            <push-ros-namespace namespace="twist"/>
            <include file="$(find-pkg-share yabloc_launch)/launch/impl/twist.launch.xml"/>
        </group>

    </group>
</launch>