<launch>
    <arg name="use_sim_time" default="true"/>

    <arg name="src_image" default="/sensing/camera/traffic_light/image_raw/compressed"/>
    <arg name="src_info" default="/sensing/camera/traffic_light/camera_info"/>
    <arg name="resized_image" default="/sensing/camera/undistorted/image_raw"/>
    <arg name="resized_info" default="/sensing/camera/undistorted/camera_info"/>

    <arg name="min_segment_length" default="-1.0"/>
    <arg name="max_segment_distance" default="50.0"/>
    <arg name="max_lateral_distance" default="10.0"/>
    <arg name="initialpose_cov_xx_yy" default="[16.0,0.25]"/>
    <arg name="ignore_less_than_float" default="true"/>

    <group>
        <push-ros-namespace namespace="localization"/>

        <!-- initializer -->
        <group>
            <push-ros-namespace namespace="initializer"/>
            <node name="particle_initializer_node" pkg="particle_initializer" exec="particle_initializer_node" output="screen" args="--ros-args --log-level info">
                <param name="cov_xx_yy" value="$(var initialpose_cov_xx_yy)"/>
                <remap from="initialpose" to="/initialpose"/>
                <remap from="map/vector_map" to="/map/vector_map"/>
            </node>
            <node name="gnss_based_pose_initializer" pkg="particle_initializer" exec="gnss_based_pose_initializer" output="screen" args="--ros-args --log-level info">
                <remap from="ublox_topic" to="/sensing/gnss/ublox/navpvt"/>
                <remap from="pose" to="/localization/pf/initial_gnss_pose"/>
            </node>
        </group>

        <!-- particle filter -->
        <group>
            <push-ros-namespace namespace="pf"/>
            <include file="$(find-pkg-share pcdless_launch)/launch/impl/pf.launch.xml">
                <arg name="use_sim_time" value="$(var use_sim_time)" />
            </include>
        </group>

        <!-- image processing -->
        <group>
            <push-ros-namespace namespace="imgproc"/>
            <include file="$(find-pkg-share pcdless_launch)/launch/impl/imgproc.launch.xml">
                <arg name="use_sim_time" value="$(var use_sim_time)" />
                <arg name="src_image" value="$(var src_image)"/>
                <arg name="src_info" value="$(var src_info)"/>
                <arg name="resized_image" value="$(var resized_image)"/>
                <arg name="resized_info" value="$(var resized_info)"/>
            </include>
        </group>

        <!-- anti_shadow -->
        <group>
            <push-ros-namespace namespace="imgproc"/>
            <include file="$(find-pkg-share pcdless_launch)/launch/impl/antishadow.launch.xml">
                <arg name="use_sim_time" value="$(var use_sim_time)" />
                <arg name="resized_image" value="$(var resized_image)"/>
                <arg name="resized_info" value="$(var resized_info)"/>
            </include>
        </group>

        <!-- twist -->
        <group>
            <push-ros-namespace namespace="twist"/>
            <include file="$(find-pkg-share pcdless_launch)/launch/impl/twist.launch.xml">
                <arg name="use_sim_time" value="$(var use_sim_time)" />
            </include>
        </group>

        <!-- validation -->
        <group>
            <push-ros-namespace namespace="validation"/>
            <include file="$(find-pkg-share pcdless_launch)/launch/impl/validation.launch.xml"/>
        </group>

        <!-- map -->
        <group>
            <push-ros-namespace namespace="map"/>
            <include file="$(find-pkg-share pcdless_launch)/launch/impl/map.launch.xml"/>
        </group>

        <!-- control/command/control_cmd visualizer -->
        <node name="command_publisher" pkg="pcdless_launch" exec="control_command_publisher.py" output="screen" args="--ros-args --log-level info"/>

        <!-- static tf -->
        <node name="base_link_tf" pkg="tf2_ros" exec="static_transform_publisher" args="--frame-id /particle_filter --child-frame-id /base_link"/>
    </group>
</launch>