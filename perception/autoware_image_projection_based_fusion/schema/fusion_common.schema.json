{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Parameters for Synchronization of RoI Fusion Nodes",
  "type": "object",
  "definitions": {
    "fusion_common": {
      "type": "object",
      "properties": {
        "rois_timestamp_offsets": {
          "type": "array",
          "items": {
            "type": "number",
            "minimum": 0.0
          },
          "description": "An array of timestamp offsets for each camera [s].",
          "minItems": 2,
          "default": [0.06167, 0.011167, 0.045, 0.02833, 0.07833, 0.095]
        },
        "timeout_ms": {
          "type": "number",
          "description": "A timeout value can be assigned within a single frame [s].",
          "default": 0.07,
          "minimum": 0.001,
          "maximum": 0.1
        },
        "image_buffer_size": {
          "type": "integer",
          "description": "The number of image buffer size for debug.",
          "default": 15,
          "minimum": 1
        },
        "point_project_to_unrectified_image": {
          "type": "array",
          "description": "An array of options indicating whether to project point to unrectified image or not.",
          "default": [false, false, false, false, false, false]
        },
        "debug_mode": {
          "type": "boolean",
          "description": "Whether to debug or not.",
          "default": false
        },
        "filter_scope_min_x": {
          "type": "number",
          "description": "Minimum x position to be considered for debug [m].",
          "default": -100.0
        },
        "filter_scope_min_y": {
          "type": "number",
          "description": "Minimum y position to be considered for debug [m].",
          "default": -100.0
        },
        "filter_scope_min_z": {
          "type": "number",
          "description": "Minimum z position to be considered for debug [m].",
          "default": -100.0
        },
        "filter_scope_max_x": {
          "type": "number",
          "description": "Maximum x position to be considered for debug [m].",
          "default": 100.0
        },
        "filter_scope_max_y": {
          "type": "number",
          "description": "Maximum y position to be considered for debug [m].",
          "default": 100.0
        },
        "filter_scope_max_z": {
          "type": "number",
          "description": "Maximum z position [m].",
          "default": 100.0
        },
        "approximate_camera_projection": {
          "type": "array",
          "description": "An array of options indicating whether to use approximated projection for each camera.",
          "default": [true, true, true, true, true, true]
        },
        "approximation_grid_cell_width": {
          "type": "number",
          "description": "The width of grid cell used in approximated projection [pixel].",
          "default": 1.0
        },
        "approximation_grid_cell_height": {
          "type": "number",
          "description": "The height of grid cell used in approximated projection [pixel].",
          "default": 1.0
        },
        "matching_strategy": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["naive", "advanced"],
              "default": "advanced",
              "description": "Set it to `advanced` if you want to use more accurate and complicated logic for matching LiDAR and camera; otherwise, set it to `naive`."
            },
            "threshold": {
              "type": "number",
              "description": "A maximum threshold value to synchronize RoIs from multiple cameras [s].",
              "default": 0.05,
              "minimum": 0.0,
              "maximum": 0.1
            },
            "det3d_noise_window": {
              "type": "number",
              "description": "det3d noise window in seconds.",
              "default": 0.001,
              "minimum": 0.0
            },
            "rois_timestamp_noise_window": {
              "type": "array",
              "items": {
                "type": "number",
                "minimum": 0.0
              },
              "default": [0.005, 0.005, 0.005, 0.005, 0.005, 0.005],
              "minItems": 2,
              "description": "List of camera timestamp noise windows in seconds. The noise values should be specified in the same order as the input_topics."
            }
          },
          "required": ["type"],
          "dependencies": {
            "type": {
              "oneOf": [
                {
                  "properties": { "type": { "const": "naive" } },
                  "required": ["threshold"],
                  "not": {
                    "required": ["det3d_noise_window", "rois_timestamp_noise_window"]
                  }
                },
                {
                  "properties": { "type": { "const": "advanced" } },
                  "required": ["det3d_noise_window", "rois_timestamp_noise_window"],
                  "not": {
                    "required": ["threshold"]
                  }
                }
              ]
            }
          }
        }
      }
    }
  },
  "properties": {
    "/**": {
      "type": "object",
      "properties": {
        "ros__parameters": {
          "$ref": "#/definitions/fusion_common"
        }
      },
      "required": ["ros__parameters"]
    }
  },
  "required": ["/**"]
}
